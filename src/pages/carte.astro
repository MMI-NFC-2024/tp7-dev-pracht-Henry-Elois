---
import "leaflet/dist/leaflet.css";
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <main class="max-w-5xl mx-auto p-8">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-4">
        Carte des établissements d'enseignement supérieur
      </h1>
      <p class="text-gray-600 leading-relaxed">
        Cette carte interactive présente la localisation des établissements
        d'enseignement supérieur en France. Elle est accompagnée d'une
        description et d'une liste textuelle des établissements pour garantir
        une accessibilité complète.
      </p>
    </header>
    <figure
      class="border-2 border-gray-300 rounded-lg mb-8 focus:outline-none focus:ring-4 focus:ring-blue-400"
      aria-label="Visualisation géographique des établissements d’enseignement supérieur"
    >
      <figcaption class="p-4 bg-gray-50 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 mb-1">
          Répartition géographique des établissements
        </h2>
        <p class="text-gray-500 text-sm">
          Figure 1. Carte interactive affichant les établissements
          d’enseignement supérieur en France. Vous pouvez naviguer avec la
          souris ou le clavier et cliquer sur les marqueurs pour plus
          d’informations.
        </p>
      </figcaption>
      <div
        id="map"
        class="w-full h-[600px] rounded-b-lg"
        role="img"
        aria-label="Carte interactive des établissements d’enseignement supérieur en France"
        tabindex="0"
      >
      </div>
    </figure>
    <section aria-labelledby="infos-titre" class="mb-8">
      <h2 id="infos-titre" class="text-xl font-semibold text-gray-700 mb-3">
        Informations sur la carte
      </h2>
      <div
        id="map-info"
        class="bg-gray-50 border border-gray-200 rounded-md p-4 italic"
        aria-live="polite"
        aria-atomic="true"
      >
        <p>
          Carte centrée sur la France. Utilisez les flèches du clavier pour
          naviguer sur la carte.
        </p>
      </div>
    </section>
  </main>
</Layout>

<script>
  import L from "leaflet";
  import listeEtablissements from "../assets/listeEtablissements.json";

  const map = L.map("map", { keyboard: true, keyboardPanDelta: 80 }).setView(
    [46.6033, 1.883],
    6
  );

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
      "&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",
  }).addTo(map);

 
  listeEtablissements.forEach((etab) => {
    const marker = L.marker([etab.lat, etab.lon], {
      title: etab.name,
      alt: `Établissement ${etab.name}`,
    }).addTo(map);
    marker.bindPopup(`
      <div role="dialog" aria-label="Informations sur l'établissement">
        <h3 class="text-blue-700 font-semibold">${etab.name}</h3>
        <p><strong>Coordonnées :</strong> ${etab.lat.toFixed(4)}, ${etab.lon.toFixed(4)}</p>
      </div>
    `);
  });
</script>
